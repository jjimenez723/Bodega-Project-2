import{o as J,i as ne,a as ae}from"./enhancements-m85IZWfI.js";/* empty css                   */import{w as O}from"./paths-CH8zUY__.js";function A(){window.map&&typeof window.map.invalidateSize=="function"&&window.setTimeout(()=>window.map.invalidateSize(),120)}function re(){J(()=>{const t=document.getElementById("control-panel");if(!t)return;const e=document.getElementById("compactPanelBtn"),a=document.getElementById("minimizePanelBtn"),c=document.getElementById("restorePanelBtn"),o=document.getElementById("showPanelBtn");let r=!1,d=()=>{};e&&e.addEventListener("click",()=>{if(t.classList.contains("collapsed"))return;t.classList.toggle("compact");const s=e.querySelector("i");s&&(s.classList.toggle("fa-expand-alt",t.classList.contains("compact")),s.classList.toggle("fa-compress-alt",!t.classList.contains("compact"))),A(),t.classList.contains("collapsed")||window.requestAnimationFrame(d)}),a&&a.addEventListener("click",()=>{t.classList.contains("collapsed")||(r=t.classList.contains("compact"),t.classList.add("collapsed"),t.classList.remove("compact"),A())}),c&&c.addEventListener("click",()=>{t.classList.remove("collapsed"),r&&t.classList.add("compact"),A(),window.requestAnimationFrame(d)}),o&&o.addEventListener("click",()=>{t.classList.remove("collapsed"),r&&t.classList.add("compact"),A(),window.requestAnimationFrame(d)});const n=()=>{o&&(o.style.display=t.classList.contains("collapsed")?"block":"none")};n(),new MutationObserver(()=>{n(),t.classList.contains("collapsed")||window.requestAnimationFrame(d)}).observe(t,{attributes:!0,attributeFilter:["class"]});const g=document.getElementById("main-flex-container"),i=document.getElementById("panel-resizer"),p=document.querySelector(".sticky-header");let l=null;const m=()=>{const s=document.body;if(!s)return l;const h=p?Math.round(p.getBoundingClientRect().height):0,I=window.innerHeight||document.documentElement.clientHeight||0,N=Math.max(I-h,0);return s.style.setProperty("--map-header-offset",h+"px"),s.style.setProperty("--map-available-height",N+"px"),l=N,N};if(m(),!i||!g)return;const u=window.matchMedia("(max-width: 700px)"),f={width:240,height:160},b={width:320,height:260};let B=t.getBoundingClientRect().width||340,v=Math.max(f.height,Math.min(t.getBoundingClientRect().height||f.height,window.innerHeight*.45)),E=null,w=null,x=i.dataset.axis==="y"?"y":"x",H=0,k=0;const F=()=>{E||(E=window.requestAnimationFrame(()=>{E=null,A()}))},M=()=>{const s=l,h=m();return typeof h=="number"&&h!==s&&F(),h},Z=()=>{const h=(g.getBoundingClientRect().width||window.innerWidth)-b.width;return h>f.width?h:f.width},U=()=>{const h=(g.getBoundingClientRect().height||window.innerHeight)-b.height;return h>f.height?h:f.height},T=s=>{const h=Math.min(Math.max(s,f.width),Z());t.style.width=`${h}px`,B=h},S=s=>{const h=U(),I=Math.min(Math.max(s,f.height),h);t.style.height=`${I}px`,t.style.flexBasis=`${I}px`,v=I},ee=()=>{t.style.removeProperty("width")},te=()=>{t.style.removeProperty("height"),t.style.removeProperty("flex-basis")};d=()=>{if(M(),t.classList.contains("collapsed"))return;if(u.matches){B=t.getBoundingClientRect().width||B,x="y",ee();const h=U();v=Math.min(Math.max(v,f.height),h),S(v),i.dataset.axis="y",i.setAttribute("aria-orientation","horizontal"),i.setAttribute("aria-label","Resize map control panel height")}else{v=t.getBoundingClientRect().height||v,x="x",te();const h=Z();B=Math.min(Math.max(B,f.width),h),T(B),i.dataset.axis="x",i.setAttribute("aria-orientation","vertical"),i.setAttribute("aria-label","Resize map control panel width")}F()},p&&typeof ResizeObserver<"u"&&new ResizeObserver(()=>{M()}).observe(p);const D=()=>{if(w!==null){try{i.releasePointerCapture(w)}catch{}w=null,i.classList.remove("active"),t.classList.remove("no-transition"),document.body.classList.remove("panel-resizing-x","panel-resizing-y"),F()}},W=s=>{if(w!==null){if(x==="x"){const h=s.clientX-k;T(H+h)}else{const h=s.clientY-k;S(H+h)}F()}};i.addEventListener("pointerdown",s=>{if(!t.classList.contains("collapsed")){x=i.dataset.axis==="y"?"y":"x",w=s.pointerId,H=x==="x"?t.getBoundingClientRect().width:t.getBoundingClientRect().height,k=x==="x"?s.clientX:s.clientY,t.classList.add("no-transition"),i.classList.add("active"),document.body.classList.add(x==="x"?"panel-resizing-x":"panel-resizing-y");try{i.setPointerCapture(w)}catch{}s.preventDefault()}}),i.addEventListener("pointermove",W),i.addEventListener("pointerup",s=>{W(s),D()}),i.addEventListener("pointercancel",D),window.addEventListener("pointerup",D),window.addEventListener("blur",D);const z=24;i.addEventListener("keydown",s=>{if(t.classList.contains("collapsed"))return;const h=i.dataset.axis==="y"?"y":"x";if(h==="x"&&(s.key==="ArrowLeft"||s.key==="ArrowRight")){s.preventDefault();const I=s.key==="ArrowLeft"?-z:z;T(B+I),F()}else if(h==="y"&&(s.key==="ArrowUp"||s.key==="ArrowDown")){s.preventDefault();const I=s.key==="ArrowUp"?-z:z;S(v+I),F()}});const oe=()=>{if(M(),t.classList.contains("collapsed")){F();return}u.matches?S(v):T(B),F()};typeof u.addEventListener=="function"?u.addEventListener("change",d):typeof u.addListener=="function"&&u.addListener(d),window.addEventListener("resize",oe,{passive:!0}),d(),t.addEventListener("transitionend",s=>{(s.propertyName==="width"||s.propertyName==="height")&&!t.classList.contains("collapsed")&&F()})})}const G=new Map;async function V(t){if(G.has(t))return G.get(t);const e=await fetch(t,{cache:"no-cache"});if(!e.ok)throw new Error("Failed to load "+t+": "+e.status+" "+e.statusText);const a=await e.json();return G.set(t,a),a}function P(t,e=.5){return t.map(a=>{const c=a?.geometry?.coordinates;if(!c)return null;const[o,r]=c;return[r,o,e]}).filter(Boolean)}const q={produce:O("data/fixed_fresh_food.geojson"),fastFood:O("data/fast_food.geojson"),boundary:O("data/newark_boundary_corrected.geojson")},_=1,C=60,j=Object.freeze({southWest:[40.6737966266808,-74.2513883524854],northEast:[40.7882755927157,-74.1140973062534]}),X=.03,$=.015;function Y(t,e){return L.divIcon({html:e,className:t,iconSize:[24,24],iconAnchor:[12,12]})}function K(t){const e=t?.geometry?.coordinates;if(!e)return"";const a=e[0],c=e[1],o=t.properties??{};let r="<strong>"+(o.name||"Fresh Food Location")+"</strong><br>Type: "+(o.type||"Fresh Food");return o.description&&(r+="<br>"+o.description),o.distance_rutgers_1&&(r+="<br>"+o.distance_rutgers_1),o.distance_rutgers_2&&(r+="<br>"+o.distance_rutgers_2),o.source&&(r+="<br><small>Source: "+o.source+"</small>"),r+="<br><a href='https://www.google.com/maps/dir/?api=1&destination="+c+","+a+"' target='_blank'>Directions</a>",r}function Q(t){const e=t?.geometry?.coordinates;if(!e)return"";const a=e[0],c=e[1],o=t.properties??{},r=o.name||"Fast Food",d=o.type||"Fast Food";return"<strong>"+r+"</strong><br>"+d+"<br><a href='https://www.google.com/maps/dir/?api=1&destination="+c+","+a+"' target='_blank'>Directions</a>"}function ie(t){document.querySelectorAll("#map div.leaflet-overlay-pane > canvas").forEach(a=>{a.style.opacity=t})}function R(t,e,a,c){t.clearLayers(),e.forEach(o=>{const r=o?.geometry?.coordinates;if(!r)return;const d=r[0],n=r[1];if(typeof n!="number"||typeof d!="number")return;const y=L.marker([n,d],{icon:a}).bindPopup(c(o));t.addLayer(y)})}function se(){J(async()=>{if(typeof L>"u")return;if(L.HeatLayer&&typeof L.HeatLayer.prototype._initCanvas=="function"&&!L.HeatLayer.prototype._willReadFrequentlyPatched){const y=L.HeatLayer.prototype._initCanvas;L.HeatLayer.prototype._initCanvas=function(){if(y.call(this),this._canvas&&this._canvas.getContext){const l=this._canvas.getContext("2d",{willReadFrequently:!0});l&&(this._ctx=l)}};const g=L.HeatLayer.prototype.redraw,i=L.HeatLayer.prototype._redraw,p=L.HeatLayer.prototype._reset;L.HeatLayer.prototype.redraw=function(){return!this._map||!this._map._panes?(this._frame=null,this):g.call(this)},L.HeatLayer.prototype._redraw=function(){if(!this._map||!this._map._panes){this._frame=null;return}i.call(this)},L.HeatLayer.prototype._reset=function(){!this._map||!this._map._panes||p.call(this)},L.HeatLayer.prototype._willReadFrequentlyPatched=!0}if(!document.getElementById("map"))return;const e=L.latLngBounds(j.southWest,j.northEast),a=e.pad(X),c=e.pad($),o=L.map("map",{maxZoom:18,center:e.getCenter(),zoom:13,minZoom:12,maxBounds:a,maxBoundsViscosity:1,scrollWheelZoom:!0,doubleClickZoom:!0,touchZoom:!0,bounceAtZoomLimits:!1});o.fitBounds(c);const r=o.getBoundsZoom(a,!1);o.setMinZoom(r),o.setMaxBounds(a),window.map=o;const d={standard:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}),gray:L.tileLayer("https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenMapTiles & Stadia Maps"})};d.standard.addTo(o);const n={showHeatmap:!0,showBorder:!0,showLegend:!0,heatSettings:{radius:C,intensity:_},produce:{raw:[],heatData:[],heat:null,cluster:L.markerClusterGroup({chunkedLoading:!0}),icon:null},fastFood:{raw:[],heatData:[],heat:null,cluster:L.markerClusterGroup({chunkedLoading:!0}),icon:null},overlays:{boundary:null,boundaryGhost:null,radiusCircle:null}};try{const[y,g,i]=await Promise.all([V(q.produce),V(q.fastFood),V(q.boundary)]);n.produce.raw=y.features??[],n.fastFood.raw=g.features??[],n.produce.icon=Y("custom-div-icon","<i class='fas fa-apple-alt fresh-food-icon' style='font-size:24px;'></i>"),n.fastFood.icon=Y("custom-div-icon","<i class='fas fa-hamburger fast-food-icon' style='font-size:24px;'></i>"),R(n.produce.cluster,n.produce.raw,n.produce.icon,K),R(n.fastFood.cluster,n.fastFood.raw,n.fastFood.icon,Q),n.produce.heatData=P(n.produce.raw,_),n.fastFood.heatData=P(n.fastFood.raw,_),n.produce.heat=L.heatLayer(n.produce.heatData,{radius:n.heatSettings.radius,gradient:{.4:"blue",1:"cyan"}}).addTo(o),n.fastFood.heat=L.heatLayer(n.fastFood.heatData,{radius:n.heatSettings.radius,gradient:{.4:"red",1:"orange"}}).addTo(o);const p=i.features?.find(f=>{const b=f?.properties?.NAME;return b&&b.toLowerCase()==="newark"});if(p){n.overlays.boundary=L.geoJSON(p,{style:{color:"#008000",weight:4,fillColor:"#008000",fillOpacity:.04}}).addTo(o),n.overlays.boundaryGhost=L.geoJSON(p,{style:{opacity:0,fillOpacity:0},interactive:!1}).addTo(o);const f=n.overlays.boundary.getBounds(),b=f.pad(X);o.fitBounds(f.pad($)),o.setMaxBounds(b);const B=o.getBoundsZoom(b,!1);o.setMinZoom(B)}const l=de(o,n),m=le(o,n),u=ce(o,n,l,m);ue(o,n,d,l),pe(o,n,u,l),fe(o,n,u,l,m)}catch(y){console.error("Failed to initialize map",y)}})}function de(t,e){const a=document.getElementById("intensitySlider"),c=document.getElementById("sizeSlider"),o=(y,g)=>{if(!y)return g;const{max:i}=y;if(!i)return g;y.value=i;const p=parseFloat(i);return Number.isNaN(p)?g:p},r=()=>{if(!e.showHeatmap)return;const y=c?parseInt(c.value||`${C}`,10):C,g=a?parseFloat(a.value||`${_}`):_,i=Number.isNaN(y)?C:y,p=Number.isNaN(g)?_:g;e.heatSettings.radius=i,e.heatSettings.intensity=p;const l=(m,u)=>{m&&(m.options.radius=i,m._map&&(m.setOptions({radius:i}),m.setLatLngs(u)))};l(e.produce.heat,e.produce.heatData),l(e.fastFood.heat,e.fastFood.heatData),ie(p)},d=o(a,_),n=o(c,C);return e.heatSettings.intensity=d,e.heatSettings.radius=n,r(),a&&a.addEventListener("input",r),c&&c.addEventListener("input",r),t.on("layeradd layerremove zoomend moveend",()=>{e.showHeatmap&&r()}),window.setTimeout(r,200),{refresh:r}}function ce(t,e,a,c){const o=document.getElementById("produceToggle"),r=document.getElementById("fastfoodToggle"),d=document.getElementById("layerModeBtn"),n=document.getElementById("legendToggleBtn"),y=m=>!m||m.classList.contains("active"),g=()=>{if(!y(o)){e.produce.heat&&t.removeLayer(e.produce.heat),t.removeLayer(e.produce.cluster);return}e.showHeatmap?(e.produce.heat&&!t.hasLayer(e.produce.heat)&&t.addLayer(e.produce.heat),t.hasLayer(e.produce.cluster)&&t.removeLayer(e.produce.cluster)):(e.produce.heat&&t.hasLayer(e.produce.heat)&&t.removeLayer(e.produce.heat),t.hasLayer(e.produce.cluster)||t.addLayer(e.produce.cluster))},i=()=>{if(!y(r)){e.fastFood.heat&&t.removeLayer(e.fastFood.heat),t.removeLayer(e.fastFood.cluster);return}e.showHeatmap?(e.fastFood.heat&&!t.hasLayer(e.fastFood.heat)&&t.addLayer(e.fastFood.heat),t.hasLayer(e.fastFood.cluster)&&t.removeLayer(e.fastFood.cluster)):(e.fastFood.heat&&t.hasLayer(e.fastFood.heat)&&t.removeLayer(e.fastFood.heat),t.hasLayer(e.fastFood.cluster)||t.addLayer(e.fastFood.cluster))},p=()=>{n&&(n.textContent=e.showLegend?"Hide Map Legend":"Show Map Legend",n.setAttribute("aria-pressed",e.showLegend?"true":"false")),c&&typeof c.applyVisibility=="function"&&c.applyVisibility()},l=()=>{d&&(d.textContent=e.showHeatmap?"Switch to Cluster View":"Switch to Heatmap View"),g(),i(),p(),e.showHeatmap&&a.refresh()};return o&&o.addEventListener("click",()=>{o.classList.toggle("active"),l()}),r&&r.addEventListener("click",()=>{r.classList.toggle("active"),l()}),n&&n.addEventListener("click",()=>{e.showLegend=!e.showLegend,p()}),d&&d.addEventListener("click",()=>{e.showHeatmap=!e.showHeatmap,l()}),l(),{refresh:l}}function le(t,e){let a=null;const c=L.control({position:"bottomright"});c.onAdd=()=>(a=L.DomUtil.create("div","map-legend"),a.innerHTML="<div><i class='fas fa-apple-alt fresh-food-icon' style='font-size: 16px; margin-right: 6px;'></i> Fresh Food</div><div><i class='fas fa-hamburger fast-food-icon' style='font-size: 16px; margin-right: 6px;'></i> Fast Food</div><div><span class='legend-line' style='border-color:#008000'></span> Newark</div><div><span class='legend-circle'></span> Filter</div><div><span class='legend-cluster'></span> Clusters</div>",a.setAttribute("role","group"),a.setAttribute("aria-label","Map legend"),a.setAttribute("aria-hidden",e.showLegend?"false":"true"),a),c.addTo(t);const o=()=>{a&&(a.classList.toggle("is-hidden",!e.showLegend),a.setAttribute("aria-hidden",String(!e.showLegend)))};return o(),{applyVisibility:o,get element(){return a}}}function ue(t,e,a,c){const o=document.getElementById("accessToggle");if(!o)return;const r=(d,n)=>{d&&(d.options.gradient=n,d._map&&d.setOptions({gradient:n}))};o.addEventListener("change",d=>{d.target.checked?(t.removeLayer(a.standard),a.gray.addTo(t),r(e.produce.heat,{.4:"#00429d",1:"#73a2c6"}),r(e.fastFood.heat,{.4:"#b10026",1:"#f4a582"})):(t.removeLayer(a.gray),a.standard.addTo(t),r(e.produce.heat,{.4:"blue",1:"cyan"}),r(e.fastFood.heat,{.4:"red",1:"orange"})),e.showHeatmap&&c.refresh()})}function pe(t,e,a,c){const o=document.getElementById("addressInput"),r=document.getElementById("latInput"),d=document.getElementById("lngInput"),n=document.getElementById("radiusInput"),y=document.getElementById("centerFilterBtn"),g=document.getElementById("filterBtn"),i=document.getElementById("address"),p=document.getElementById("radius"),l=(u,f)=>{if(!u||Number.isNaN(f))return;e.overlays.radiusCircle&&t.removeLayer(e.overlays.radiusCircle),e.overlays.radiusCircle=L.circle(u,{radius:f*1e3,color:"#333",dashArray:"4"}).addTo(t);const b=(w,x)=>e.overlays.boundaryGhost?(leafletPip.pointInLayer([x,w],e.overlays.boundaryGhost)||[]).length>0:!0,B=w=>w.filter(x=>{const H=x?.geometry?.coordinates;if(!H)return!1;const k=H[0],F=H[1];return typeof F!="number"||typeof k!="number"?!1:u.distanceTo([F,k])<=f*1e3&&b(F,k)}),v=B(e.produce.raw),E=B(e.fastFood.raw);R(e.produce.cluster,v,e.produce.icon,K),R(e.fastFood.cluster,E,e.fastFood.icon,Q),e.produce.heatData=P(v,_),e.fastFood.heatData=P(E,_),e.showHeatmap&&c.refresh(),a.refresh()},m=async u=>{const b=await(await fetch("https://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(u))).json();if(!Array.isArray(b)||b.length===0)throw new Error("Address not found.");const B=parseFloat(b[0].lat),v=parseFloat(b[0].lon);return L.latLng(B,v)};y&&y.addEventListener("click",async()=>{try{let u=null;if(r&&r.value&&d&&d.value?u=L.latLng(parseFloat(r.value),parseFloat(d.value)):o&&o.value&&(u=await m(o.value)),!u){alert("Enter an address or latitude/longitude.");return}t.setView(u,14);const f=parseFloat(n&&n.value||"0");l(u,f)}catch(u){alert(u.message)}}),g&&g.addEventListener("click",async()=>{try{if(!i||!i.value){alert("Enter an address.");return}const u=await m(i.value);t.setView(u,14);const f=parseFloat(p&&p.value||"0");l(u,f)}catch(u){alert(u.message)}})}function fe(t,e,a,c,o){const r=document.getElementById("control-panel"),d=document.getElementById("exportImgBtn"),n=document.getElementById("exportSpinner"),y=document.getElementById("printBtn"),g=document.getElementById("shareLinkBtn"),i=document.getElementById("borderToggleBtn"),p=l=>{e.showBorder=l,e.overlays.boundary&&(l?(e.overlays.boundary.addTo(t),i&&(i.textContent="Hide Newark Border")):(t.removeLayer(e.overlays.boundary),i&&(i.textContent="Show Newark Border")))};i&&i.addEventListener("click",()=>{p(!e.showBorder)}),d&&d.addEventListener("click",()=>{if(!r)return;if(typeof html2canvas>"u"){alert("Export library is unavailable.");return}const l=e.showHeatmap,m=e.showBorder;e.showHeatmap=!0,p(!1),a.refresh(),c.refresh();const f=Array.from(document.querySelectorAll(".map-legend div")).filter(w=>{const x=w.textContent||"";return/Filter|Clusters/i.test(x)});f.forEach(w=>{w.style.display="none"});const b=e.overlays.radiusCircle&&t.hasLayer(e.overlays.radiusCircle),B=e.overlays.boundaryGhost&&t.hasLayer(e.overlays.boundaryGhost);e.overlays.radiusCircle&&t.removeLayer(e.overlays.radiusCircle),e.overlays.boundaryGhost&&t.removeLayer(e.overlays.boundaryGhost),r.classList.add("collapsed"),d.setAttribute("disabled","true"),n&&(n.style.display="flex");const v=document.getElementById("map"),E=document.createElement("div");E.textContent="Newark Food Access Map",E.style.cssText=["position:absolute","top:1.5rem","left:50%","transform:translateX(-50%)","background:rgba(255,255,255,0.95)","padding:8px 16px","border-radius:8px","font-weight:bold","font-size:16px","color:#2563eb","z-index:2002","box-shadow:0 2px 8px rgba(0,0,0,0.1)"].join(";"),v.appendChild(E),window.setTimeout(()=>{html2canvas(v,{backgroundColor:"#ffffff",scale:2,useCORS:!0,allowTaint:!0,foreignObjectRendering:!1,logging:!1,width:v.offsetWidth,height:v.offsetHeight}).then(w=>{const x=document.createElement("a");x.download="newark-food-map-export.png",x.href=w.toDataURL(),x.click()}).catch(w=>{alert("Export failed: "+w.message)}).finally(()=>{E.remove(),f.forEach(w=>{w.style.display=""}),e.overlays.radiusCircle&&b&&t.addLayer(e.overlays.radiusCircle),e.overlays.boundaryGhost&&B&&t.addLayer(e.overlays.boundaryGhost),p(m),e.showHeatmap=l,a.refresh(),c.refresh(),o&&typeof o.applyVisibility=="function"&&o.applyVisibility(),n&&(n.style.display="none"),d.removeAttribute("disabled"),r.classList.remove("collapsed")})},300)}),g&&g.addEventListener("click",()=>{const l=window.location.href;navigator.share?navigator.share({title:document.title,url:l}):navigator.clipboard?navigator.clipboard.writeText(l).then(()=>{alert("Map link copied to clipboard!")}).catch(()=>{prompt("Copy this link:",l)}):prompt("Copy this link:",l)}),y&&y.addEventListener("click",()=>{const l=e.showHeatmap,m=e.showBorder,u=t.getCenter(),f=t.getZoom();e.showHeatmap=!0,p(!0),a.refresh(),c.refresh(),window.setTimeout(()=>{t.setView([40.7357,-73.413],13,{animate:!1}),t.invalidateSize(),document.getElementById("map").scrollIntoView({behavior:"instant",block:"start"}),window.setTimeout(()=>{window.print(),window.setTimeout(()=>{e.showHeatmap=l,p(m),t.setView(u,f,{animate:!1}),a.refresh(),c.refresh()},800)},300)},200)}),p(e.showBorder)}ne();ae();re();se();
