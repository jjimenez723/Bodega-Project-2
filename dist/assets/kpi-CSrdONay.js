import{o as I,i as O,a as x}from"./enhancements-m85IZWfI.js";/* empty css                   */function q(){I(()=>{const M={Farm:["Produce","Category","Farm Cost $/lb","Farm Markup %","Farm Sale $/lb","Farm Shrink %","Farm GP $/lb","Farm GM %","Qty lbs"],Distributor:["Produce","Category","Farm Sale $/lb","Dist Handling $/lb","Dist Margin %","Dist Sale $/lb","Dist Shrink %","Dist GP $/lb","Dist GM %","Qty lbs"],Bodega:["Produce","Category","Dist. Sale $/lb","Retail Handling $/lb","Retail Margin %","Retail Price $/lb","Bodega Shrink %","Bodega GP $/lb","Bodega GM %","Qty lbs"]},v=["Farm GP $/lb","Farm GM %","Dist. GP $/lb","Dist. GM %","Bodega GP $/lb","Bodega GM %"];let c,d=[],u=[],D=null;const h=new Set,S=new Set;let b=new Set;const f=(e,t=2)=>isFinite(e)?+(+e).toFixed(t):0;function E(e){const t=c.getSourceDataAtRow(e);Object.keys(t).forEach(l=>{t[l]===""&&(t[l]=0),t[l]=Number(t[l])||t[l]}),t["Farm Sale $/lb"]=t["Farm Cost $/lb"]*(1+t["Farm Markup %"]/100),t["Dist Sale $/lb"]=(t["Farm Sale $/lb"]+t["Dist Handling $/lb"])*(1+t["Dist Margin %"]/100),t["Retail Price $/lb"]=(t["Dist Sale $/lb"]+t["Retail Handling $/lb"])*(1+t["Retail Margin %"]/100),t["Farm GP $/lb"]=t["Farm Sale $/lb"]-t["Farm Cost $/lb"],t["Farm GM %"]=t["Farm Sale $/lb"]?100*t["Farm GP $/lb"]/t["Farm Sale $/lb"]:0,t["Dist GP $/lb"]=t["Dist Sale $/lb"]-t["Farm Sale $/lb"]-t["Dist Handling $/lb"],t["Dist GM %"]=t["Dist Sale $/lb"]?100*t["Dist GP $/lb"]/t["Dist Sale $/lb"]:0,t["Bodega GP $/lb"]=t["Retail Price $/lb"]*(1-t["Bodega Shrink %"]/100)-t["Dist Sale $/lb"]-t["Retail Handling $/lb"],t["Bodega GM %"]=t["Retail Price $/lb"]?100*t["Bodega GP $/lb"]/t["Retail Price $/lb"]:0}function L(e){Object.keys(e).forEach(t=>{e[t]===""&&(e[t]=0),e[t]=Number(e[t])||e[t]}),e["Farm Sale $/lb"]=e["Farm Cost $/lb"]*(1+e["Farm Markup %"]/100),e["Dist Sale $/lb"]=(e["Farm Sale $/lb"]+e["Dist Handling $/lb"])*(1+e["Dist Margin %"]/100),e["Retail Price $/lb"]=(e["Dist Sale $/lb"]+e["Retail Handling $/lb"])*(1+e["Retail Margin %"]/100),e["Farm GP $/lb"]=e["Farm Sale $/lb"]-e["Farm Cost $/lb"],e["Farm GM %"]=e["Farm Sale $/lb"]?100*e["Farm GP $/lb"]/e["Farm Sale $/lb"]:0,e["Dist GP $/lb"]=e["Dist Sale $/lb"]-e["Farm Sale $/lb"]-e["Dist Handling $/lb"],e["Dist GM %"]=e["Dist Sale $/lb"]?100*e["Dist GP $/lb"]/e["Dist Sale $/lb"]:0,e["Bodega GP $/lb"]=e["Retail Price $/lb"]*(1-e["Bodega Shrink %"]/100)-e["Dist Sale $/lb"]-e["Retail Handling $/lb"],e["Bodega GM %"]=e["Retail Price $/lb"]?100*e["Bodega GP $/lb"]/e["Retail Price $/lb"]:0}function y(e){console.log("TOT-DEBUG",e),e==="Distributor"&&console.table(c.getSourceData().slice(0,3),["Produce","Dist. Sale $/lb","Dist. GP $/lb","Qty lbs"]);const t=c.getSourceData();let l=0,n=0,a=0;t.forEach(i=>{if(!b.has(i.Produce))return;const r=Number(i["Qty lbs"])||0;if(!r)return;a+=r;const s=p=>Number(p)||0;e==="Farm"?(l+=s(i["Farm Sale $/lb"])*r,n+=s(i["Farm GP $/lb"])*r):e==="Distributor"?(l+=s(i["Dist Sale $/lb"])*r,n+=s(i["Dist GP $/lb"])*r):e==="Bodega"&&(l+=s(i["Retail Price $/lb"])*(1-s(i["Bodega Shrink %"])/100)*r,n+=s(i["Bodega GP $/lb"])*r)});const o=l?100*n/l:0,m=`<ul class="list-unstyled mb-0">
           <li><strong>Total Qty (lbs):</strong> ${f(a,0)}</li>
           <li><strong>Total Revenue ($):</strong> ${f(l,2)}</li>
           <li><strong>Total GP ($):</strong> ${f(n,2)}</li>
           <li><strong>Gross Margin %:</strong> ${f(o,1)}</li>
         </ul>`;document.getElementById("totalsContent").innerHTML=m}function F(){const e=[];u.forEach((l,n)=>{if(l==="Produce"||l==="Category")return;let a=!1;h.has(l)?a=!0:S.has(l)?a=!1:D&&M[D].includes(l)?a=!0:a=!1,a||e.push(n)});const t=c.getPlugin("hiddenColumns");t.showColumns(u.map((l,n)=>n)),e.length&&t.hideColumns(e),c.render()}function C(e){D=e,document.getElementById("totalsCard").classList.remove("d-none"),F(),c.getSourceData().forEach((t,l)=>E(l)),y(e)}function w(){return u.map(e=>{const t=e==="Produce"||e==="Category"||v.includes(e),l=e.includes("%"),n=e.includes("$")||l||e==="Qty lbs"||v.includes(e);return{data:e,readOnly:t,type:n?"numeric":"text",numericFormat:n?{pattern:l?"0.0":"0.00"}:void 0}})}function R(){const e=document.getElementById("columnToggles");e.innerHTML="",u.forEach((t,l)=>{const n="chk_"+l,a=t==="Produce"||t==="Category";e.insertAdjacentHTML("beforeend",`<div class="toggle-item">
            <label class="toggle-switch">
              <input type="checkbox" ${a?"checked disabled":""} checked id="${n}">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label ${a?"disabled":""}">${t}</span>
          </div>`),e.lastElementChild.querySelector("input").addEventListener("change",o=>{o.target.disabled||(o.target.checked?(h.add(t),S.delete(t)):(S.add(t),h.delete(t)),F())})})}function k(e,t){let l,n,a,o,m=!1;t.addEventListener("mousedown",s=>{m=!0,e.classList.add("draggable"),l=s.clientX,n=s.clientY;const p=e.getBoundingClientRect();a=p.left,o=p.top,document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)});function i(s){m&&(e.style.transform="none",e.style.left=a+s.clientX-l+"px",e.style.top=o+s.clientY-n+"px")}function r(){m=!1,e.classList.remove("draggable"),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r)}}document.addEventListener("click",e=>{if(e.target.classList.contains("accordion-button")){const t=e.target,l=t.parentElement.nextElementSibling;t.classList.toggle("collapsed"),l.classList.toggle("show")}});const g=document.getElementById("columnOptions"),$=document.getElementById("offcanvasBackdrop");console.log("Offcanvas element:",g),console.log("Backdrop element:",$);function H(){g.classList.add("show"),$.classList.add("show"),document.body.classList.add("offcanvas-open"),console.log("Offcanvas opened:",g.classList.contains("show")),console.log("Offcanvas content:",g.innerHTML),console.log("Column toggles:",document.getElementById("columnToggles").innerHTML),console.log("Crop toggles:",document.getElementById("cropToggles").innerHTML)}function P(){g.classList.remove("show"),$.classList.remove("show"),document.body.classList.remove("offcanvas-open")}const G=document.getElementById("gearBtn");G?(G.onclick=H,console.log("Gear button found and configured")):console.error("Gear button not found!"),document.getElementById("closeCanvas").onclick=P,$.onclick=P,document.addEventListener("keydown",e=>{e.key==="Escape"&&g.classList.contains("show")&&P()}),k(g,g.querySelector(".offcanvas-header")),Papa.parse("/data/Supply_Chain_KPI_Builder.csv",{download:!0,header:!0,dynamicTyping:!0,complete:e=>{d=e.data.filter(l=>l.Produce),d.forEach(l=>{"Dist. Sale $/lb"in l&&(l["Dist Sale $/lb"]=l["Dist. Sale $/lb"],delete l["Dist. Sale $/lb"]),"Dist. Margin %"in l&&(l["Dist Margin %"]=l["Dist. Margin %"],delete l["Dist. Margin %"]),"Dist. Handling $/lb"in l&&(l["Dist Handling $/lb"]=l["Dist. Handling $/lb"],delete l["Dist. Handling $/lb"]),"Dist. Shrink %"in l&&(l["Dist Shrink %"]=l["Dist. Shrink %"],delete l["Dist. Shrink %"])}),d.forEach(L),u=Object.keys(d[0]);const t=document.getElementById("hot");c=new Handsontable(t,{data:d,colHeaders:u,columns:w(),licenseKey:"non-commercial-and-evaluation",stretchH:"all",height:"100%",rowHeaders:!0,colWidths:120,rowHeights:35,hiddenColumns:{columns:[],indicators:!0},hiddenRows:{rows:[],indicators:!0},afterChange:(l,n)=>{if(n==="loadData"||!l)return;new Set(l.map(o=>o[0])).forEach(o=>E(o)),c.render();const a=document.querySelector('input[name="role"]:checked');a&&y(a.value)}}),d.forEach(l=>b.add(l.Produce)),T(),R(),B(),console.log("Content loaded, gear button should work now"),console.log("Column toggles built:",document.getElementById("columnToggles").children.length),console.log("Crop toggles built:",document.getElementById("cropToggles").children.length)}}),document.querySelectorAll(".role-toggle").forEach(e=>{e.addEventListener("click",t=>{document.querySelectorAll(".role-toggle").forEach(l=>l.classList.remove("active")),t.target.classList.add("active"),C(t.target.dataset.role)})});function B(){const e=[];d.forEach((l,n)=>{b.has(l.Produce)||e.push(n)});const t=c.getPlugin("hiddenRows");t.showRows([...Array(d.length).keys()]),e.length&&t.hideRows(e)}function T(){const e=document.getElementById("cropToggles");e.innerHTML="",[...b].sort().forEach(l=>{const n="crop_"+l.replace(/[^a-z0-9]/gi,"_");e.insertAdjacentHTML("beforeend",`<div class="toggle-item">
              <label class="toggle-switch">
                <input type="checkbox" checked id="${n}">
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label">${l}</span>
            </div>`),e.lastElementChild.querySelector("input").addEventListener("change",a=>{a.target.checked?b.add(l):b.delete(l),B();const o=document.querySelector(".role-toggle.active");o&&y(o.dataset.role)})})}})}O();x();q();
