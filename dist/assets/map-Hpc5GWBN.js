import{o as V,i as J,a as X}from"./enhancements-m85IZWfI.js";/* empty css                   */import{w as R}from"./paths-CH8zUY__.js";function T(){window.map&&typeof window.map.invalidateSize=="function"&&window.setTimeout(()=>window.map.invalidateSize(),120)}function Y(){V(()=>{const t=document.getElementById("control-panel");if(!t)return;const e=document.getElementById("compactPanelBtn"),i=document.getElementById("minimizePanelBtn"),o=document.getElementById("restorePanelBtn"),n=document.getElementById("showPanelBtn");let a=!1,s=()=>{};e&&e.addEventListener("click",()=>{if(t.classList.contains("collapsed"))return;t.classList.toggle("compact");const c=e.querySelector("i");c&&(c.classList.toggle("fa-expand-alt",t.classList.contains("compact")),c.classList.toggle("fa-compress-alt",!t.classList.contains("compact"))),T(),t.classList.contains("collapsed")||window.requestAnimationFrame(s)}),i&&i.addEventListener("click",()=>{t.classList.contains("collapsed")||(a=t.classList.contains("compact"),t.classList.add("collapsed"),t.classList.remove("compact"),T())}),o&&o.addEventListener("click",()=>{t.classList.remove("collapsed"),a&&t.classList.add("compact"),T(),window.requestAnimationFrame(s)}),n&&n.addEventListener("click",()=>{t.classList.remove("collapsed"),a&&t.classList.add("compact"),T(),window.requestAnimationFrame(s)});const f=()=>{n&&(n.style.display=t.classList.contains("collapsed")?"block":"none")};f(),new MutationObserver(()=>{f(),t.classList.contains("collapsed")||window.requestAnimationFrame(s)}).observe(t,{attributes:!0,attributeFilter:["class"]});const r=document.getElementById("panel-resizer"),u=document.getElementById("main-flex-container");if(!r||!u)return;const l=window.matchMedia("(max-width: 700px)"),m={width:240,height:160},b={width:320,height:260};let d=t.getBoundingClientRect().width||340,y=Math.max(m.height,Math.min(t.getBoundingClientRect().height||m.height,window.innerHeight*.45)),x=null,w=null,g=r.dataset.axis==="y"?"y":"x",v=0,F=0;const B=()=>{x||(x=window.requestAnimationFrame(()=>{x=null,T()}))},C=()=>{const h=(u.getBoundingClientRect().width||window.innerWidth)-b.width;return h>m.width?h:m.width},_=()=>{const h=(u.getBoundingClientRect().height||window.innerHeight)-b.height;return h>m.height?h:m.height},I=c=>{const h=Math.min(Math.max(c,m.width),C());t.style.width=`${h}px`,d=h},H=c=>{const h=_(),k=Math.min(Math.max(c,m.height),h);t.style.height=`${k}px`,t.style.flexBasis=`${k}px`,y=k},Z=()=>{t.style.removeProperty("width")},W=()=>{t.style.removeProperty("height"),t.style.removeProperty("flex-basis")};s=()=>{if(t.classList.contains("collapsed"))return;if(l.matches){d=t.getBoundingClientRect().width||d,g="y",Z();const h=_();y=Math.min(Math.max(y,m.height),h),H(y),r.dataset.axis="y",r.setAttribute("aria-orientation","horizontal"),r.setAttribute("aria-label","Resize map control panel height")}else{y=t.getBoundingClientRect().height||y,g="x",W();const h=C();d=Math.min(Math.max(d,m.width),h),I(d),r.dataset.axis="x",r.setAttribute("aria-orientation","vertical"),r.setAttribute("aria-label","Resize map control panel width")}B()};const S=()=>{if(w!==null){try{r.releasePointerCapture(w)}catch{}w=null,r.classList.remove("active"),t.classList.remove("no-transition"),document.body.classList.remove("panel-resizing-x","panel-resizing-y"),B()}},q=c=>{if(w!==null){if(g==="x"){const h=c.clientX-F;I(v+h)}else{const h=c.clientY-F;H(v+h)}B()}};r.addEventListener("pointerdown",c=>{if(!t.classList.contains("collapsed")){g=r.dataset.axis==="y"?"y":"x",w=c.pointerId,v=g==="x"?t.getBoundingClientRect().width:t.getBoundingClientRect().height,F=g==="x"?c.clientX:c.clientY,t.classList.add("no-transition"),r.classList.add("active"),document.body.classList.add(g==="x"?"panel-resizing-x":"panel-resizing-y");try{r.setPointerCapture(w)}catch{}c.preventDefault()}}),r.addEventListener("pointermove",q),r.addEventListener("pointerup",c=>{q(c),S()}),r.addEventListener("pointercancel",S),window.addEventListener("pointerup",S),window.addEventListener("blur",S);const M=24;r.addEventListener("keydown",c=>{if(t.classList.contains("collapsed"))return;const h=r.dataset.axis==="y"?"y":"x";if(h==="x"&&(c.key==="ArrowLeft"||c.key==="ArrowRight")){c.preventDefault();const k=c.key==="ArrowLeft"?-M:M;I(d+k),B()}else if(h==="y"&&(c.key==="ArrowUp"||c.key==="ArrowDown")){c.preventDefault();const k=c.key==="ArrowUp"?-M:M;H(y+k),B()}});const $=()=>{t.classList.contains("collapsed")||(l.matches?H(y):I(d),B())};typeof l.addEventListener=="function"?l.addEventListener("change",s):typeof l.addListener=="function"&&l.addListener(s),window.addEventListener("resize",$,{passive:!0}),s(),t.addEventListener("transitionend",c=>{(c.propertyName==="width"||c.propertyName==="height")&&!t.classList.contains("collapsed")&&B()})})}const P=new Map;async function N(t){if(P.has(t))return P.get(t);const e=await fetch(t,{cache:"no-cache"});if(!e.ok)throw new Error("Failed to load "+t+": "+e.status+" "+e.statusText);const i=await e.json();return P.set(t,i),i}function z(t,e=.5){return t.map(i=>{const o=i?.geometry?.coordinates;if(!o)return null;const[n,a]=o;return[a,n,e]}).filter(Boolean)}const G={produce:R("data/fixed_fresh_food.geojson"),fastFood:R("data/fast_food.geojson"),boundary:R("data/newark_boundary_corrected.geojson")},E=1,A=60;function O(t,e){return L.divIcon({html:e,className:t,iconSize:[24,24],iconAnchor:[12,12]})}function U(t){const e=t?.geometry?.coordinates;if(!e)return"";const i=e[0],o=e[1],n=t.properties??{};let a="<strong>"+(n.name||"Fresh Food Location")+"</strong><br>Type: "+(n.type||"Fresh Food");return n.description&&(a+="<br>"+n.description),n.distance_rutgers_1&&(a+="<br>"+n.distance_rutgers_1),n.distance_rutgers_2&&(a+="<br>"+n.distance_rutgers_2),n.source&&(a+="<br><small>Source: "+n.source+"</small>"),a+="<br><a href='https://www.google.com/maps/dir/?api=1&destination="+o+","+i+"' target='_blank'>Directions</a>",a}function j(t){const e=t?.geometry?.coordinates;if(!e)return"";const i=e[0],o=e[1],n=t.properties??{},a=n.name||"Fast Food",s=n.type||"Fast Food";return"<strong>"+a+"</strong><br>"+s+"<br><a href='https://www.google.com/maps/dir/?api=1&destination="+o+","+i+"' target='_blank'>Directions</a>"}function Q(t){document.querySelectorAll("#map div.leaflet-overlay-pane > canvas").forEach(i=>{i.style.opacity=t})}function D(t,e,i,o){t.clearLayers(),e.forEach(n=>{const a=n?.geometry?.coordinates;if(!a)return;const s=a[0],f=a[1];if(typeof f!="number"||typeof s!="number")return;const p=L.marker([f,s],{icon:i}).bindPopup(o(n));t.addLayer(p)})}function K(){V(async()=>{if(typeof L>"u")return;if(L.HeatLayer&&typeof L.HeatLayer.prototype._initCanvas=="function"&&!L.HeatLayer.prototype._willReadFrequentlyPatched){const n=L.HeatLayer.prototype._initCanvas;L.HeatLayer.prototype._initCanvas=function(){if(n.call(this),this._canvas&&this._canvas.getContext){const p=this._canvas.getContext("2d",{willReadFrequently:!0});p&&(this._ctx=p)}};const a=L.HeatLayer.prototype.redraw,s=L.HeatLayer.prototype._redraw,f=L.HeatLayer.prototype._reset;L.HeatLayer.prototype.redraw=function(){return!this._map||!this._map._panes?(this._frame=null,this):a.call(this)},L.HeatLayer.prototype._redraw=function(){if(!this._map||!this._map._panes){this._frame=null;return}s.call(this)},L.HeatLayer.prototype._reset=function(){!this._map||!this._map._panes||f.call(this)},L.HeatLayer.prototype._willReadFrequentlyPatched=!0}if(!document.getElementById("map"))return;const e=L.map("map",{minZoom:10,maxZoom:18,center:[40.7357,-74.1724],zoom:13,maxBounds:L.latLngBounds([40.65,-74.3],[40.85,-74.05]),maxBoundsViscosity:.8,scrollWheelZoom:!0,doubleClickZoom:!0,touchZoom:!0,bounceAtZoomLimits:!0});window.map=e;const i={standard:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}),gray:L.tileLayer("https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenMapTiles & Stadia Maps"})};i.standard.addTo(e);const o={showHeatmap:!0,showBorder:!0,heatSettings:{radius:A,intensity:E},produce:{raw:[],heatData:[],heat:null,cluster:L.markerClusterGroup({chunkedLoading:!0}),icon:null},fastFood:{raw:[],heatData:[],heat:null,cluster:L.markerClusterGroup({chunkedLoading:!0}),icon:null},overlays:{boundary:null,boundaryGhost:null,radiusCircle:null}};try{const[n,a,s]=await Promise.all([N(G.produce),N(G.fastFood),N(G.boundary)]);o.produce.raw=n.features??[],o.fastFood.raw=a.features??[],o.produce.icon=O("custom-div-icon","<i class='fas fa-apple-alt fresh-food-icon' style='font-size:24px;'></i>"),o.fastFood.icon=O("custom-div-icon","<i class='fas fa-hamburger fast-food-icon' style='font-size:24px;'></i>"),D(o.produce.cluster,o.produce.raw,o.produce.icon,U),D(o.fastFood.cluster,o.fastFood.raw,o.fastFood.icon,j),o.produce.heatData=z(o.produce.raw,E),o.fastFood.heatData=z(o.fastFood.raw,E),o.produce.heat=L.heatLayer(o.produce.heatData,{radius:o.heatSettings.radius,gradient:{.4:"blue",1:"cyan"}}).addTo(e),o.fastFood.heat=L.heatLayer(o.fastFood.heatData,{radius:o.heatSettings.radius,gradient:{.4:"red",1:"orange"}}).addTo(e);const f=s.features?.find(u=>{const l=u?.properties?.NAME;return l&&l.toLowerCase()==="newark"});f&&(o.overlays.boundary=L.geoJSON(f,{style:{color:"#008000",weight:4,fillColor:"#008000",fillOpacity:.04}}).addTo(e),o.overlays.boundaryGhost=L.geoJSON(f,{style:{opacity:0,fillOpacity:0},interactive:!1}).addTo(e));const p=ee(e,o),r=te(e,o,p);oe(e),ne(e,o,i,p),ae(e,o,r,p),re(e,o,r,p)}catch(n){console.error("Failed to initialize map",n)}})}function ee(t,e){const i=document.getElementById("intensitySlider"),o=document.getElementById("sizeSlider"),n=(p,r)=>{if(!p)return r;const{max:u}=p;if(!u)return r;p.value=u;const l=parseFloat(u);return Number.isNaN(l)?r:l},a=()=>{if(!e.showHeatmap)return;const p=o?parseInt(o.value||`${A}`,10):A,r=i?parseFloat(i.value||`${E}`):E,u=Number.isNaN(p)?A:p,l=Number.isNaN(r)?E:r;e.heatSettings.radius=u,e.heatSettings.intensity=l;const m=(b,d)=>{b&&(b.options.radius=u,b._map&&(b.setOptions({radius:u}),b.setLatLngs(d)))};m(e.produce.heat,e.produce.heatData),m(e.fastFood.heat,e.fastFood.heatData),Q(l)},s=n(i,E),f=n(o,A);return e.heatSettings.intensity=s,e.heatSettings.radius=f,a(),i&&i.addEventListener("input",a),o&&o.addEventListener("input",a),t.on("layeradd layerremove zoomend moveend",()=>{e.showHeatmap&&a()}),window.setTimeout(a,200),{refresh:a}}function te(t,e,i){const o=document.getElementById("produceToggle"),n=document.getElementById("fastfoodToggle"),a=document.getElementById("layerModeBtn"),s=u=>!u||u.classList.contains("active"),f=()=>{if(!s(o)){e.produce.heat&&t.removeLayer(e.produce.heat),t.removeLayer(e.produce.cluster);return}e.showHeatmap?(e.produce.heat&&!t.hasLayer(e.produce.heat)&&t.addLayer(e.produce.heat),t.hasLayer(e.produce.cluster)&&t.removeLayer(e.produce.cluster)):(e.produce.heat&&t.hasLayer(e.produce.heat)&&t.removeLayer(e.produce.heat),t.hasLayer(e.produce.cluster)||t.addLayer(e.produce.cluster))},p=()=>{if(!s(n)){e.fastFood.heat&&t.removeLayer(e.fastFood.heat),t.removeLayer(e.fastFood.cluster);return}e.showHeatmap?(e.fastFood.heat&&!t.hasLayer(e.fastFood.heat)&&t.addLayer(e.fastFood.heat),t.hasLayer(e.fastFood.cluster)&&t.removeLayer(e.fastFood.cluster)):(e.fastFood.heat&&t.hasLayer(e.fastFood.heat)&&t.removeLayer(e.fastFood.heat),t.hasLayer(e.fastFood.cluster)||t.addLayer(e.fastFood.cluster))},r=()=>{a&&(a.textContent=e.showHeatmap?"Switch to Cluster View":"Switch to Heatmap View"),f(),p(),e.showHeatmap&&i.refresh()};return o&&o.addEventListener("click",()=>{o.classList.toggle("active"),r()}),n&&n.addEventListener("click",()=>{n.classList.toggle("active"),r()}),a&&a.addEventListener("click",()=>{e.showHeatmap=!e.showHeatmap,r()}),r(),{refresh:r}}function oe(t){const e=L.control({position:"bottomleft"});e.onAdd=()=>{const i=L.DomUtil.create("div","map-legend");return i.innerHTML="<div><i class='fas fa-apple-alt fresh-food-icon' style='font-size: 16px; margin-right: 6px;'></i> Fresh Food</div><div><i class='fas fa-hamburger fast-food-icon' style='font-size: 16px; margin-right: 6px;'></i> Fast Food</div><div><span class='legend-line' style='border-color:#008000'></span> Newark</div><div><span class='legend-circle'></span> Filter</div><div><span class='legend-cluster'></span> Clusters</div>",i},e.addTo(t)}function ne(t,e,i,o){const n=document.getElementById("accessToggle");if(!n)return;const a=(s,f)=>{s&&(s.options.gradient=f,s._map&&s.setOptions({gradient:f}))};n.addEventListener("change",s=>{s.target.checked?(t.removeLayer(i.standard),i.gray.addTo(t),a(e.produce.heat,{.4:"#00429d",1:"#73a2c6"}),a(e.fastFood.heat,{.4:"#b10026",1:"#f4a582"})):(t.removeLayer(i.gray),i.standard.addTo(t),a(e.produce.heat,{.4:"blue",1:"cyan"}),a(e.fastFood.heat,{.4:"red",1:"orange"})),e.showHeatmap&&o.refresh()})}function ae(t,e,i,o){const n=document.getElementById("addressInput"),a=document.getElementById("latInput"),s=document.getElementById("lngInput"),f=document.getElementById("radiusInput"),p=document.getElementById("centerFilterBtn"),r=document.getElementById("filterBtn"),u=document.getElementById("address"),l=document.getElementById("radius"),m=(d,y)=>{if(!d||Number.isNaN(y))return;e.overlays.radiusCircle&&t.removeLayer(e.overlays.radiusCircle),e.overlays.radiusCircle=L.circle(d,{radius:y*1e3,color:"#333",dashArray:"4"}).addTo(t);const x=(F,B)=>e.overlays.boundaryGhost?(leafletPip.pointInLayer([B,F],e.overlays.boundaryGhost)||[]).length>0:!0,w=F=>F.filter(B=>{const C=B?.geometry?.coordinates;if(!C)return!1;const _=C[0],I=C[1];return typeof I!="number"||typeof _!="number"?!1:d.distanceTo([I,_])<=y*1e3&&x(I,_)}),g=w(e.produce.raw),v=w(e.fastFood.raw);D(e.produce.cluster,g,e.produce.icon,U),D(e.fastFood.cluster,v,e.fastFood.icon,j),e.produce.heatData=z(g,E),e.fastFood.heatData=z(v,E),e.showHeatmap&&o.refresh(),i.refresh()},b=async d=>{const x=await(await fetch("https://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(d))).json();if(!Array.isArray(x)||x.length===0)throw new Error("Address not found.");const w=parseFloat(x[0].lat),g=parseFloat(x[0].lon);return L.latLng(w,g)};p&&p.addEventListener("click",async()=>{try{let d=null;if(a&&a.value&&s&&s.value?d=L.latLng(parseFloat(a.value),parseFloat(s.value)):n&&n.value&&(d=await b(n.value)),!d){alert("Enter an address or latitude/longitude.");return}t.setView(d,14);const y=parseFloat(f&&f.value||"0");m(d,y)}catch(d){alert(d.message)}}),r&&r.addEventListener("click",async()=>{try{if(!u||!u.value){alert("Enter an address.");return}const d=await b(u.value);t.setView(d,14);const y=parseFloat(l&&l.value||"0");m(d,y)}catch(d){alert(d.message)}})}function re(t,e,i,o){const n=document.getElementById("control-panel"),a=document.getElementById("exportImgBtn"),s=document.getElementById("exportSpinner"),f=document.getElementById("printBtn"),p=document.getElementById("shareLinkBtn"),r=document.getElementById("borderToggleBtn"),u=l=>{e.showBorder=l,e.overlays.boundary&&(l?(e.overlays.boundary.addTo(t),r&&(r.textContent="Hide Newark Border")):(t.removeLayer(e.overlays.boundary),r&&(r.textContent="Show Newark Border")))};r&&r.addEventListener("click",()=>{u(!e.showBorder)}),a&&a.addEventListener("click",()=>{if(!n)return;if(typeof html2canvas>"u"){alert("Export library is unavailable.");return}const l=e.showHeatmap,m=e.showBorder;e.showHeatmap=!0,u(!1),i.refresh(),o.refresh();const d=Array.from(document.querySelectorAll(".map-legend div")).filter(v=>{const F=v.textContent||"";return/Filter|Clusters/i.test(F)});d.forEach(v=>{v.style.display="none"});const y=e.overlays.radiusCircle&&t.hasLayer(e.overlays.radiusCircle),x=e.overlays.boundaryGhost&&t.hasLayer(e.overlays.boundaryGhost);e.overlays.radiusCircle&&t.removeLayer(e.overlays.radiusCircle),e.overlays.boundaryGhost&&t.removeLayer(e.overlays.boundaryGhost),n.classList.add("collapsed"),a.setAttribute("disabled","true"),s&&(s.style.display="flex");const w=document.getElementById("map"),g=document.createElement("div");g.textContent="Newark Food Access Map",g.style.cssText=["position:absolute","top:1.5rem","left:50%","transform:translateX(-50%)","background:rgba(255,255,255,0.95)","padding:8px 16px","border-radius:8px","font-weight:bold","font-size:16px","color:#2563eb","z-index:2002","box-shadow:0 2px 8px rgba(0,0,0,0.1)"].join(";"),w.appendChild(g),window.setTimeout(()=>{html2canvas(w,{backgroundColor:"#ffffff",scale:2,useCORS:!0,allowTaint:!0,foreignObjectRendering:!1,logging:!1,width:w.offsetWidth,height:w.offsetHeight}).then(v=>{const F=document.createElement("a");F.download="newark-food-map-export.png",F.href=v.toDataURL(),F.click()}).catch(v=>{alert("Export failed: "+v.message)}).finally(()=>{g.remove(),d.forEach(v=>{v.style.display=""}),e.overlays.radiusCircle&&y&&t.addLayer(e.overlays.radiusCircle),e.overlays.boundaryGhost&&x&&t.addLayer(e.overlays.boundaryGhost),u(m),e.showHeatmap=l,i.refresh(),o.refresh(),s&&(s.style.display="none"),a.removeAttribute("disabled"),n.classList.remove("collapsed")})},300)}),p&&p.addEventListener("click",()=>{const l=window.location.href;navigator.share?navigator.share({title:document.title,url:l}):navigator.clipboard?navigator.clipboard.writeText(l).then(()=>{alert("Map link copied to clipboard!")}).catch(()=>{prompt("Copy this link:",l)}):prompt("Copy this link:",l)}),f&&f.addEventListener("click",()=>{const l=e.showHeatmap,m=e.showBorder,b=t.getCenter(),d=t.getZoom();e.showHeatmap=!0,u(!0),i.refresh(),o.refresh(),window.setTimeout(()=>{t.setView([40.7357,-73.413],13,{animate:!1}),t.invalidateSize(),document.getElementById("map").scrollIntoView({behavior:"instant",block:"start"}),window.setTimeout(()=>{window.print(),window.setTimeout(()=>{e.showHeatmap=l,u(m),t.setView(b,d,{animate:!1}),i.refresh(),o.refresh()},800)},300)},200)}),u(e.showBorder)}J();X();Y();K();
